{% extends "base.html" %}

{% import "book-utils.html" as book_utils %}

{% block title %}
{% set current_book_url = book_utils::get_current_book_url() %}
{% set current_book_title = book_utils::get_current_book_title(current_book_url=current_book_url) %}
{% if page.title %}
Gal's {{ current_book_title }} Book - {{ page.title }}
{% elif section.title %}
Gal's {{ current_book_title }} Book - {{ section.title }}
{% else %}
{{ config.title }}
{% endif %}
{% endblock title %}

{% block body_class %}book-body{% endblock body_class %}

{% block styles%}
{% set main_css = get_url(path="main.css") %}
{% set book_css = get_url(path="book.css") %}
<link rel="stylesheet" href="{{ main_css | safe }}">
<link rel="stylesheet" href="{{ book_css | safe }}">
{% block css %}
{% endblock css %}
{% endblock styles %}

{% block posthead %}
{% block js %}
{% endblock js %}
{% block extra_head %}
{% endblock extra_head %}
{% endblock posthead %}

{% block content %}
<!-- Sidebar defaults to class 'menu'. CSS max-width 600px breakpoint handles closing it automatically -->
<div class="menu">
  {% block before_menu %}
  {% endblock before_menu %}
  <nav role="navigation">
    <ul>
      {% block menu %}
      {% set book_url = book_utils::get_current_book_url() %}
      {% set book_section_path = book_utils::get_book_section_path(current_book_url=book_url) %}
      {% set index = get_section(path=book_section_path | trim) %}
      {% if book_url | trim == "interviews" %}
      <li class="live-interviews-link">
        <a href="{{ get_url(path='interviews/live/') | safe }}"><strong>Live Interviews</strong></a>
      </li>
      {% endif %}
      {% set_global chapter_num = 0 %}
      {% for s in index.subsections %}
      {% set subsection = get_section(path=s) %}
      {% if not subsection.extra.hidden %}
      {% set_global chapter_num = chapter_num + 1 %}
      {% set section_link = subsection.redirect_to | default(value=subsection.permalink) %}
      <li {% if current_path==subsection.path %}class="active" {% endif %}>
        <a href="{{ section_link | safe }}">
          {% if config.extra.book_number_chapters %}<strong>{{ chapter_num }}.</strong>{% endif %}
          {{ subsection.title }}
        </a>
        {% if subsection.pages %}
        <ul>
          {% for page in subsection.pages %}
          <li {% if current_path==page.path %}class="active" {% endif %}>
            <a href="{{ page.permalink }}">
              {% if config.extra.book_number_chapters %}<strong>{{ chapter_num }}.{{ loop.index
                }}.</strong>{% endif %}
              {{ page.title }}
            </a>
          </li>
          {% endfor %}
        </ul>
        {% endif %}
      </li>
      {% endif %}
      {% endfor %}
      {% endblock menu %}
    </ul>
  </nav>
  {% block after_menu %}
  {% endblock after_menu %}
</div>

<!-- Page defaults to class 'page'. CSS max-width 600px breakpoint handles making it full-width automatically -->
<div class="page">

  <div class="page__content">
    {% if config.build_search_index %}
    <div class="search-container">
      <input id="search" type="search" placeholder="Search..">
      <div class="search-results">
        <div class="search-results__header"></div>
        <ul class="search-results__items"></ul>
      </div>
    </div>
    {% endif %}
    <button class="sidebar-toggle-inline" id="sidebar-toggle-inline" aria-label="Toggle Chapters">
      <span class="toggle-icon">â˜°</span> Chapters
    </button>
    <div class="book-content">
      {% block bookcontent %}
      {% endblock bookcontent %}
    </div>
  </div>

  <nav class="book-pagination">
    <div class="prev-link">
      {% block prev_link %}
      {% endblock prev_link %}
    </div>

    <div class="next-link">
      {% block next_link %}
      {% endblock next_link %}
    </div>
  </nav>
</div>

{% block js_body %}
{% set elasticlunr_js = get_url(path="elasticlunr.min.js") %}
{% set search_index_js = get_url(path="search_index.en.js") %}
{% set book_js = get_url(path="book.js") %}
{% if config.build_search_index %}
<script type="text/javascript" src="{{ elasticlunr_js | safe }}"></script>
<script type="text/javascript" src="{{ search_index_js | safe }}"></script>
{% endif %}
<script type="text/javascript" src="{{ book_js | safe }}"></script>
<script async
  src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
{% endblock js_body %}
{% endblock content %}