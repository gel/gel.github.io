<!DOCTYPE html>
<html lang="en">

<head>
  <meta http-equiv="x-ua-compatible" content="ie=edge" />
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />

  <style>
    :root {
      --accent-overlay-color: #fff;
      --body-bg: #fff;
      --body-color: #000;
      --heading-color: #000;
      --table-bg-even: #f3f3f3;
      --table-border-bottom: #dddddd;
    }

    [data-theme="dark"] {
      --accent-overlay-color: #dee2e6;
      --body-bg: #212529;
      --body-color: #abb2bf;
      --heading-color: #dee2e6;
      --table-bg-even: #2d3237;
      --table-border-bottom: #697077;
    }

    [data-theme="dark"] img {
      opacity: .75;
      transition: opacity .5s ease-in-out;
    }

    [data-theme="dark"] img:hover {
      opacity: 1;
    }

    .theme-toggle {
      cursor: pointer;
      padding: 0 10px;
      background: none;
      border: none;
      color: var(--body-color);
      font-size: 1.2rem;
    }

    @media (max-width: 600px) {
      header nav>a:not(:last-child) {
        margin-right: 0.6rem;
      }

      header a.profile-icon {
        display: none;
      }

      .theme-toggle {
        padding: 0 5px;
      }
    }

    .active-nav {
      color: var(--accent-color);
      font-weight: bold;
    }
  </style>

  <script>
    (function () {
      const localTheme = localStorage.getItem("theme");
      const systemTheme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "dark" : "light";
      const theme = localTheme || systemTheme;
      document.documentElement.setAttribute("data-theme", theme);

      // Inject CSS variables from Zola config to prevent formatter issues
      const root = document.documentElement;
      root.style.setProperty('--accent-color', '{{ config.extra.accent }}');
      root.style.setProperty('--accent-color-light', '{{ config.extra.accent_light }}');
    })();
  </script>

  <meta name="theme-color" content="{{ config.extra.accent }}" />

  {% if config.extra.profile_small %}
  {% set icon = resize_image(path=config.extra.profile_small, width=48, height=48, op="fill") -%}
  <link rel="icon" href="{{ icon.url }}" />
  {% for size in [48,72,96,144,192,256,384,512] -%}
  {% set icon = resize_image(path=config.extra.profile_small, width=size, height=size, op="fill") -%}
  <link rel="apple-touch-icon" sizes="{{size}}x{{size}}" href="{{ icon.url }}" />
  {% endfor %}
  {% endif %}

  {% if config.extra.gtag %}
  <script async src="https://www.googletagmanager.com/gtag/js?id={{ config.extra.gtag }}"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag() { dataLayer.push(arguments); }
    gtag("js", new Date());
    gtag("config", "{{ config.extra.gtag }}");
  </script>
  {% endif %}

  <meta property="og:type" content="website">

  <meta name="twitter:card" content="summary">

  {% if config.twitter %}
  <meta name="twitter:creator" content="@{{ config.twitter }}">
  <meta name="twitter:site" content="@{{ config.twitter }}">
  {% endif %}

  {% if page.extra.thumbnail %}
  <meta property="og:image" content="{{ get_url(path=page.path ~ page.extra.thumbnail) }}">
  {% elif page.extra.static_thumbnail %}
  {%if page.extra.static_thumbnail is matching("^http[s]?://") %}
  <meta property="og:image" content="{{ page.extra.static_thumbnail }}">
  {% else %}
  <meta property="og:image" content="{{ get_url(path=page.extra.static_thumbnail) }}">
  {% endif %}
  {% elif config.extra.default_og_image %}
  <meta property="og:image" content="{{ get_url(path=config.extra.default_og_image) }}">
  {% endif %}

  {% block description %}
  {% if page.description %}
  <meta name="description" content="{{ page.description }}" />
  <meta name="twitter:description" content="{{ page.description }}">
  {% else %}
  <meta name="description" content="{{ config.description }}" />
  <meta name="twitter:description" content="{{ config.description}}">
  {% endif %}
  {% endblock description %}

  {% if page.title %}
  <meta name="twitter:title" content="{{ page.title }}">
  {% else %}
  <meta name="twitter:title" content="{{ config.title }}">
  {% endif %}

  {% for link in config.extra.nav %}
  <link rel="prerender" href="{{ link.path }}" />
  {% endfor %}

  {% set icon = resize_image(path=config.extra.profile_small, width=50, height=50, op="fill") -%}
  <link rel="prefetch" href="{{ icon.url }}" />

  <title>
    {% block title %}
    {% if page.title %}
    {{ page.title }}
    {% else %}
    {{ config.title }}
    {% endif %}
    {% endblock title %}
  </title>

  {% block head %}{% endblock head %}
  {% block styles %}
  {% set css_path = "main.css" %}
  {% set animations_path = "animations.css" %}
  <link rel="stylesheet" href="{{ get_url(path=css_path) | safe }}">
  <link rel="stylesheet" href="{{ get_url(path=animations_path) | safe }}">
  {% endblock styles %}
  {% block posthead %}{% endblock posthead %}
  {% set anim_js_path = "animations.js" %}
  <script src="{{ get_url(path=anim_js_path) | safe }}" defer></script>
  <script type="module">
    import mermaid from "https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs";

    const theme = document.documentElement.getAttribute("data-theme") === "dark" ? "dark" : "default";
    mermaid.initialize({
      startOnLoad: false,
      theme: theme,
      securityLevel: "loose",
      fontFamily: "inherit"
    });

    async function renderMermaid() {
      const codeBlocks = document.querySelectorAll("pre code.language-mermaid, pre code[data-lang='mermaid']");
      for (const block of codeBlocks) {
        const pre = block.parentElement;
        const div = document.createElement("div");
        div.className = "mermaid";
        div.textContent = block.textContent;
        pre.replaceWith(div);
      }
      if (codeBlocks.length > 0) {
        await mermaid.run();
      }
    }

    document.addEventListener("DOMContentLoaded", renderMermaid);

    window.addEventListener("themeChanged", async (e) => {
      const newTheme = e.detail.theme === "dark" ? "dark" : "default";
      mermaid.initialize({ theme: newTheme });
    });
  </script>
</head>

<body>
  {% block header %}
  <header>
    <a class="profile-icon" href="/">
      <img src="{{ icon.url }}" alt="profile picture">
    </a>
    <nav>
      {% for link in config.extra.nav %}
      <a href="{{ link.path }}"
        class="{% if current_path is defined and current_path is starting_with(link.path) and link.path != '/' %}active-nav{% endif %}">{{
        link.name }}</a>
      {% endfor %}
      {% if config.extra.dark_mode %}
      <button class="theme-toggle" aria-label="Toggle Dark Mode" onclick="toggleTheme()">
        <span class="theme-icon-light">‚òÄÔ∏è</span>
        <span class="theme-icon-dark" style="display:none">üåô</span>
      </button>
      {% endif %}
    </nav>
  </header>
  {% endblock header %}
  <main>
    {% block content %} {% endblock content %}
  </main>
  <footer class="footer-page">
    {% block footer %}
    {% if config.extra.footer_page %}
    {{ config.extra.footer_page | markdown | safe }}
    {% endif %}
    {% endblock footer %}
  </footer>
  <script>
    function toggleTheme() {
      const currentTheme = document.documentElement.getAttribute("data-theme");
      const newTheme = currentTheme === "dark" ? "light" : "dark";

      document.documentElement.setAttribute("data-theme", newTheme);
      localStorage.setItem("theme", newTheme);
      updateIcons(newTheme);

      // Notify other scripts about the theme change
      window.dispatchEvent(new CustomEvent("themeChanged", { detail: { theme: newTheme } }));
    }

    function updateIcons(theme) {
      const lightIcons = document.querySelectorAll(".theme-icon-light");
      const darkIcons = document.querySelectorAll(".theme-icon-dark");

      if (theme === "dark") {
        lightIcons.forEach(icon => icon.style.display = "none");
        darkIcons.forEach(icon => icon.style.display = "inline");
      } else {
        lightIcons.forEach(icon => icon.style.display = "inline");
        darkIcons.forEach(icon => icon.style.display = "none");
      }
    }

    // Initial icon setup
    document.addEventListener("DOMContentLoaded", () => {
      updateIcons(document.documentElement.getAttribute("data-theme"));
    });
  </script>
</body>

</html>